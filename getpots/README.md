# getpots

getpotsæ˜¯shellå‘½ä»¤è¡Œç”¨æ¥è§£æä½ç½®å‚æ•°çš„å‘½ä»¤ã€‚
* getoptsæ—¶bashçš„å†…éƒ¨å‘½ä»¤
* getoptsæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬å­—ç¬¦å’Œâ€œ:â€
* æ¯ä¸€ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªæœ‰æ•ˆé€‰é¡¹ï¼ˆoptionï¼‰ï¼Œå¦‚æœå­—ç¬¦åé¢å¸¦æœ‰â€œ:â€ï¼Œè¡¨ç¤ºè¿™ä¸ªé€‰é¡¹æœ‰è‡ªå·±çš„argumentï¼Œargumentä¿å­˜åœ¨å†…ç½®å˜é‡OPTARGä¸­
* $OPTARGæ€»æ˜¯å­˜å‚¨åŸå§‹$*ä¸­ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„å…ƒç´ ä½ç½®
```text
$ getopt --help
ç”¨æ³•ï¼š
 getopt optstring parameters
 getopt [options] [--] optstring parameters
 getopt [options] -o|--options optstring [options] [--] parameters

é€‰é¡¹ï¼š
 -a, --alternative            å…è®¸é•¿é€‰é¡¹ä»¥ - å¼€å§‹
 -h, --help                   è¿™ä¸ªç®€çŸ­çš„ç”¨æ³•æŒ‡å—
 -l, --longoptions <é•¿é€‰é¡¹>  è¦è¯†åˆ«çš„é•¿é€‰é¡¹
 -n, --name <ç¨‹åºå>         å°†é”™è¯¯æŠ¥å‘Šç»™çš„ç¨‹åºå
 -o, --options <é€‰é¡¹å­—ç¬¦ä¸²>  è¦è¯†åˆ«çš„çŸ­é€‰é¡¹
 -q, --quiet                  ç¦æ­¢ getopt(3) çš„é”™è¯¯æŠ¥å‘Š
 -Q, --quiet-output           æ— æ­£å¸¸è¾“å‡º
 -s, --shell <shell>          è®¾ç½® shell å¼•ç”¨è§„åˆ™
 -T, --test                   æµ‹è¯• getopt(1) ç‰ˆæœ¬
 -u, --unquoted               ä¸å¼•ç”¨è¾“å‡º
 -V, --version                è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯
```

## ç¤ºä¾‹ä¸€
```shell
#!/bin/bash
 
function usage() {
      cat << EOF
Usage: $(basename "${BASH_SOURCE[0]}") [-s source_dir] [-d destination] [-u] [-h]"

options:

-s the path of source directory"
-d the path of destination directory"
-u upload file to the specify path
-h Print this help and exit
EOF
    exit
}

# default value
upload="false"
 
while getopts 's:d:uh' OPT; do
    case $OPT in
        s) 
            soure_dir="$OPTARG"
            ;;
        d) 
            destination_dir="$OPTARG"
            ;;
        u) 
            upload="true"
            ;;
        h) 
            usage
            ;;
        ?*) 
            usage
            ;;
    esac
done
 
echo "source dir: " $soure_dir
echo "destination dir: "$destination_dir
echo "upload status: "$upload
```
output:
```shell
[root@heketi ]# bash short_options.sh  -h
Usage: short_options.sh [-s source_dir] [-d destination] [-u] [-h]"

options:

-s the path of source directory"
-d the path of destination directory"
-u upload file to the specify path
-h Print this help and exit

[root@heketi ]# bash short_options.sh  -s /etc/init.d/  -d /usr/local/bin         
source dir:  /etc/init.d/
destination dir: /usr/local/bin
upload status: false

[root@heketi ]# bash short_options.sh  -s /etc/init.d/  -d /usr/local/bin -u
source dir:  /etc/init.d/
destination dir: /usr/local/bin
upload status: true

# æˆ‘ä»¬ä¼šå‘ç°è¿™ç§é•¿é€‰é¡¹å¹¶ä¸æ”¯æŒ
[root@heketi ]# bash short_options.sh  --help
short_options.sh: illegal option -- -         # æŠ¥é”™ä¸æ”¯æŒ
Usage: short_options.sh [-s source_dir] [-d destination] [-u] [-h]"

options:

-s the path of source directory"
-d the path of destination directory"
-u upload file to the specify path
-h Print this help and exit
```
getoptsåé¢è·Ÿçš„å­—ç¬¦ä¸²å°±æ˜¯å‚æ•°åˆ—è¡¨ï¼Œæ¯ä¸ªå­—æ¯ä»£è¡¨ä¸€ä¸ªé€‰é¡¹ï¼Œå¦‚æœå­—æ¯åé¢è·Ÿä¸€ä¸ª:ï¼Œåˆ™å°±è¡¨ç¤ºè¿™ä¸ªé€‰é¡¹è¿˜ä¼šæœ‰ä¸€ä¸ªå€¼ï¼Œæ¯”å¦‚ä¾‹å­ä¸­çš„`-s /etc/init.d/`  å’Œ`-d /usr/local/bin` ã€‚

getoptså­—ç¬¦ä¸²ä¸­æ²¡æœ‰è·Ÿéš`:`çš„å­—æ¯å°±æ˜¯å¼€å…³å‹é€‰é¡¹ï¼Œä¸éœ€è¦æŒ‡å®šå€¼ï¼Œç­‰åŒäºtrue/false,åªè¦å¸¦ä¸Šè¿™ä¸ªå‚æ•°å°±æ˜¯true, æ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­å¯¹åº”çš„-ué€‰é¡¹ï¼Œä¸æŒ‡å®š-uæ˜¯falseï¼ŒæŒ‡å®š-uå°±æ˜¯trueã€‚

getoptsè¯†åˆ«å‡ºå„ä¸ªé€‰é¡¹ä¹‹åï¼Œå°±å¯ä»¥é…åˆcaseè¿›è¡Œæ“ä½œã€‚æ“ä½œä¸­ï¼Œæœ‰ä¸¤ä¸ª"å¸¸é‡"ï¼Œä¸€ä¸ªæ˜¯OPTARGï¼Œç”¨æ¥è·å–å½“å‰é€‰é¡¹çš„å€¼ï¼›å¦å¤–ä¸€ä¸ªå°±æ˜¯OPTINDï¼Œè¡¨ç¤ºå½“å‰é€‰é¡¹åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„ä½ç§»ã€‚


æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è„šæœ¬å³æ”¯æŒæ®µé€‰é¡¹ï¼Œåˆæ”¯æŒé•¿å‚æ•°é€‰é¡¹å®ç°è¿™ä¸ªè„šæœ¬ï¼Œè®©ç”¨æˆ·çœ‹èµ·æ¥å¾ˆç›´è§‚ï¼Œè¯¥å‚æ•°çš„æƒ³è¡¨è¾¾çš„å«ä¹‰ã€‚å› æ­¤ï¼Œéœ€è¦getoptæ¥å®ç°ã€‚

# getopt

* getoptæ˜¯ä¸€ä¸ªå¤–éƒ¨å‘½ä»¤ï¼Œé€šå¸¸Linuxå‘è¡Œç‰ˆä¼šè‡ªå¸¦ 
* getoptæ”¯æŒçŸ­é€‰é¡¹å’Œé•¿é€‰é¡¹
* å¢å¼ºç‰ˆgetoptæ¯”è¾ƒå¥½ç”¨ï¼Œæ‰§è¡Œå‘½ä»¤getopt -T; echo $?,å¦‚æœè¾“å‡º4ï¼Œåˆ™ä»£è¡¨æ˜¯å¢å¼ºç‰ˆ
* å¦‚æœçŸ­é€‰é¡¹å¸¦argumentä¸”å‚æ•°å¯é€‰æ—¶ï¼Œargumentå¿…é¡»ç´§è´´é€‰é¡¹ï¼Œä¾‹å¦‚-cargè€Œä¸èƒ½æ˜¯-c arg
* å¦‚æœé•¿é€‰é¡¹å¸¦argumentä¸”å‚æ•°å¯é€‰æ—¶ï¼Œargumentå’Œé€‰é¡¹ä¹‹é—´ç”¨â€œ=â€ï¼Œä¾‹å¦‚â€“clong=argè€Œä¸èƒ½æ˜¯â€“clong arg


## ç¤ºä¾‹äºŒ

```shell
#!/bin/bash

set -Eeuo pipefail

script_dir=$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)

function usage() {
  cat << EOF
Usage: $(basename "${BASH_SOURCE[0]}") [-a [rsa|ecc]] [-d <domain>] [-n <name>] [-h]"

ğŸ’ This script will be automatic certificate genetatory.


Available options:

-a --algorithm         Algorithms supported by the issuing certificate tool. for example: rsa, ecc, default the algorithm is "rsa".
-d --domain            The name of the domain name required to issue the certificate. for example: xxx.com, abc.org, *.abc.org, default the domain name is "domain.com".
-n --name              Name of the file generated by the issuance certificate, default the name is "server".
-h --help              Print this help and exit
-v --verbose           Print script debug info
EOF
  exit
}

function parse_param() {
    domain_name=${domain_name:-domain.com}
    algorithm=${algorithm:-rsa}
    srv_key_name=${srv_key_name:-server}
    
    # -oæˆ–--optionsé€‰é¡¹åé¢æ˜¯å¯æ¥å—çš„çŸ­é€‰é¡¹ï¼Œå¦‚ab:c::ï¼Œè¡¨ç¤ºå¯æ¥å—çš„çŸ­é€‰é¡¹ä¸º-a -b -cï¼Œ
    # å…¶ä¸­-aé€‰é¡¹ä¸æ¥å‚æ•°ï¼Œ-bé€‰é¡¹åå¿…é¡»æ¥å‚æ•°ï¼Œ-cé€‰é¡¹çš„å‚æ•°ä¸ºå¯é€‰çš„
    # -læˆ–--longé€‰é¡¹åé¢æ˜¯å¯æ¥å—çš„é•¿é€‰é¡¹ï¼Œç”¨é€—å·åˆ†å¼€ï¼Œå†’å·çš„æ„ä¹‰åŒçŸ­é€‰é¡¹ã€‚
    # -né€‰é¡¹åæ¥é€‰é¡¹è§£æé”™è¯¯æ—¶æç¤ºçš„è„šæœ¬åå­—

    # parse argument of the command
    getopt_cmd=$(getopt -o a:d:n:hv --long algorithm:,domain:,name:,help,verbose -n $(basename $0) -- "$@")
    if [ $? -ne 0 ]; then
        exit 1
    fi
    eval set -- "$getopt_cmd"
    while [ -n "$1" ]; do
        case "$1" in
                -a|--algorithm)
                    algorithm="$2"
                    shift ;;
                -d|--domain)
                    domain_name="$2"
                    shift ;;
                -n|--name)
                    srv_key_name="$2"
                    shift ;;
                -h|--help)
                    usage
                    ;;
                -v|--verbose)
                    set -x
                    ;;
                --) shift
                    break ;;
                ?*) echo "$1 is not an option"
                    exit 1 ;; 
        esac
        shift
    done
}

parse_param $@

echo "algorithm: ${algorithm}"
echo "domain_name: ${domain_name}"
echo "srv_key_name:${srv_key_name}"
```
output:
```shell
# å¯ä»¥çœ‹åˆ°ä¸ç®¡æ®µé€‰é¡¹ï¼Œè¿˜æ˜¯é•¿é€‰é¡¹éƒ½å®Œç¾æ”¯æŒã€‚
[root@heketi ]# bash long_options.sh  -h
Usage: long_options.sh  [-a [rsa|ecc]] [-d <domain>] [-n <name>] [-h]"

ğŸ’ This script will be automatic certificate genetatory.


Available options:

-a --algorithm         Algorithms supported by the issuing certificate tool. for example: rsa, ecc, default the algorithm is "rsa".
-d --domain            The name of the domain name required to issue the certificate. for example: xxx.com, abc.org, *.abc.org, default the domain name is "domain.com".
-n --name              Name of the file generated by the issuance certificate, default the name is "server".
-h --help              Print this help and exit
-v --verbose           Print script debug info
[root@heketi ]# bash long_options.sh --help
Usage: long_options.sh  [-a [rsa|ecc]] [-d <domain>] [-n <name>] [-h]"

ğŸ’ This script will be automatic certificate genetatory.


Available options:

-a --algorithm         Algorithms supported by the issuing certificate tool. for example: rsa, ecc, default the algorithm is "rsa".
-d --domain            The name of the domain name required to issue the certificate. for example: xxx.com, abc.org, *.abc.org, default the domain name is "domain.com".
-n --name              Name of the file generated by the issuance certificate, default the name is "server".
-h --help              Print this help and exit
-v --verbose           Print script debug info

[root@heketi ]# bash long_options.sh  -a acc
algorithm: acc
domain_name: domain.com
srv_key_name:server
```